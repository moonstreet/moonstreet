<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kubernetes on Moonstreet</title><link>http://localhost:1313/tags/kubernetes/</link><description>Recent content in Kubernetes on Moonstreet</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>Copyright © 2008–2018, Steve Francia and the Hugo Authors; all rights reserved.</copyright><lastBuildDate>Tue, 21 Dec 2021 11:24:21 +0100</lastBuildDate><atom:link href="http://localhost:1313/tags/kubernetes/index.xml" rel="self" type="application/rss+xml"/><item><title>Terraform patterns: loops</title><link>http://localhost:1313/post/terraform-patterns-loops/</link><pubDate>Tue, 21 Dec 2021 11:24:21 +0100</pubDate><guid>http://localhost:1313/post/terraform-patterns-loops/</guid><description>
&lt;h1 id="create-multiple-resources-with-a-loop">Create multiple resources with a loop&lt;/h1>
&lt;p>If you want to create multiple instances of, say, an Azure resource group, you can add a for_each argument.
The for_each argument accepts a map or a set, and creates an instance for each item in that map or set.&lt;/p>
&lt;p>So you can create a map of key value pairs (aka a dictionary) and use it to define multiple resource groups:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="ln"> 1&lt;/span>&lt;span class="cl">&lt;span class="n">resource&lt;/span> &lt;span class="s2">&amp;#34;azurerm_resource_group&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;rg&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 2&lt;/span>&lt;span class="cl"> &lt;span class="n">for_each&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 3&lt;/span>&lt;span class="cl"> &lt;span class="n">projectx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">we&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;westeurope&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 4&lt;/span>&lt;span class="cl"> &lt;span class="n">projectx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">us&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;eastus&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 5&lt;/span>&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 6&lt;/span>&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 7&lt;/span>&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;${each.key}-rg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 8&lt;/span>&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">each&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 9&lt;/span>&lt;span class="cl"> &lt;span class="n">tags&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tags&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">10&lt;/span>&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Sure enough you can also refactor the map as a variable&lt;/p></description></item><item><title>Terraform patterns: conditionals</title><link>http://localhost:1313/post/terraform-patterns-conditionals/</link><pubDate>Tue, 21 Dec 2021 08:24:21 +0100</pubDate><guid>http://localhost:1313/post/terraform-patterns-conditionals/</guid><description>
&lt;p>This is a back to basics post about a Terraform pattern: conditionals.
It's Azure centric.&lt;/p>
&lt;h2 id="conditionals-if-then-else">Conditionals: if then else&lt;/h2>
&lt;p>Imagine we want a resource group name to follow the rules of naming convention but in other cases we don't want to.
So if there is a naming convention, implement that, if not than do not.&lt;/p>
&lt;p>For example, the naming convention should follow this pattern: &lt;code>&amp;lt;projectname&amp;gt;-&amp;lt;environment&amp;gt;-&amp;lt;resource&amp;gt;&lt;/code> .
We want every resource to be prefixed by that pattern. So if the prefix is set, please use the prefix pattern, else just take the variable of the full name.&lt;/p></description></item><item><title>Azure Kubernetes node pools with Terraform</title><link>http://localhost:1313/post/aks-nodepools/</link><pubDate>Tue, 29 Dec 2020 13:30:21 +0100</pubDate><guid>http://localhost:1313/post/aks-nodepools/</guid><description>
&lt;p>&lt;strong>In Azure Kubernetes Service (AKS), nodes of the same configuration are grouped together into node pools.&lt;/strong> These node pools contain the underlying VMs that run your applications.
The initial number of nodes and their size (SKU) is defined when you create an AKS cluster, which creates a system node pool. To support applications that have different compute or storage demands, you can create additional user node pools.&lt;/p>
&lt;p>I just copied the above text from &lt;a href="https://docs.microsoft.com/en-us/azure/aks/use-multiple-node-pools">here&lt;/a> because it is just right. To have a full understanding of node pools I encourage you to read the whole article. Also, if you plan to run Azure Kubernetes in production, I can recommend &lt;a href="https://docs.microsoft.com/en-us/azure/aks/concepts-clusters-workloads">this article&lt;/a> as well. It's all about the sizing baby!&lt;/p></description></item><item><title>Create a read-only user in Kubernetes</title><link>http://localhost:1313/post/kubernetes-readonly/</link><pubDate>Mon, 28 Dec 2020 17:10:13 +0100</pubDate><guid>http://localhost:1313/post/kubernetes-readonly/</guid><description>
&lt;p>&lt;a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/">Normal users are assumed to be managed by an outside, independent service&lt;/a>. Kubernetes does not have objects which represent normal user accounts. Normal users cannot be added to a cluster through an API call. However, any user that presents a valid certificate signed by the cluster's certificate authority (CA) is considered authenticated.
So we can create a user with read-only access to the cluster, and hand the kube config file over to that that user.&lt;/p></description></item><item><title>Install the Nginx ingress controller on K3s - or Kind - and deploy a web app</title><link>http://localhost:1313/post/k3s-with-ingress/</link><pubDate>Sat, 26 Dec 2020 16:33:46 +0100</pubDate><guid>http://localhost:1313/post/k3s-with-ingress/</guid><description>
&lt;p>Here is how to quickly install Kubernetes with ingress on your laptop.
I use this to test and create operators with the &lt;a href="https://operatorframework.io/">Operator Framework&lt;/a>. Still learning though.&lt;/p>
&lt;p>I was first using &lt;a href="https://k3s.io/">K3s&lt;/a> but then I discovered &lt;a href="https://kind.sigs.k8s.io/">Kind&lt;/a> which seems to be even faster, deployment wise. Also it leaves a smaller footprint because it runs in a Docker container. (Didn't manage to run it with podman yet). So I quickly added a paragraph about Kind if you scroll down this post.&lt;/p></description></item></channel></rss>